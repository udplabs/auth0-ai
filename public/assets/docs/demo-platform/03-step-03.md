Now it’s time to wire up authentication so your app can actually log people in. Until this step is complete, Aiya is running in “training wheels” mode. Once you’re logged in, the fun (RAG + FGA) really begins. 🚀

## ✅ Expected Outcome

By the end of this step you should:

- Be able to sign up / log in via Auth0.
- Have a working session in your app.
- Trigger AIya’s “you’re authenticated!” message.
- Unlock the rest of the lab steps.
---

## Update `.env` (*server-side variables*)

Open the **root** of your project and locate the `.env` file. Add the following:

> [!TIP]
> You can click the clipboard to just copy the following as-is and drop it in `.env`. Just be sure to *replace* the existing content.

```bash
# ========== Auth0 ==========
# Auth0 tenant domain (*without* https://)
AUTH0_DOMAIN={{idp.tenantDomain}}
```
```env
# Client ID for your lab app
AUTH0_CLIENT_ID={{TheBAInk.credentials.clientId}}
```
```env
# Normally secrets should go in .env.local, but for the sake of the lab
# we are including them here so you only have one file to edit.
# The application’s client secret (from Auth0 app settings)
AUTH0_CLIENT_SECRET={{TheBAInk.credentials.clientSecret}}
```
```bash
# A session secret (generate one yourself!)
# openssl rand -base64 32
# Windows user or do not have openssl? See tip!
AUTH0_SECRET=<randomly-generated-value>
# =================================================
```
---
> [!TIP]
> Windows PC user? No `openssl`? No worries!
>
> Check out [this cool tool](https://www.cryptool.org/en/cto/openssl/) and run `openssl rand -base64 32` in the terminal.
---
> [!IMPORTANT]
> **My values don't seem to be pre-populating. Where else can I find them?**
>
> If the values are not pre-populated above, follow these steps:
> 1. Navigate to the [Auth0 Demo Platform Dashboard](https://manage.cic-demo-platform.auth0app.com/dashboard).
> 2. Select your tenant (the one created for this lab -- you probably already have it open!).
> 3. Go to **Applications → Applications → \[the bAInk]**.
> 4. Copy the **Domain**, **Client ID**, and **Client Secret**.
> 5. `AUTH0_SECRET`: Generate using OpenSSL (or your favorite random generator):

---

> [!WARNING]
> For ease and simplicity this lab utilizes only one `.env` file.
>
> ***We do not recommend this in a production environment.***
>
> Best practice is to keep 'secrets' or sensitive information in `.env.local`.
>
> *Rule of thumb* -- **Follow best practice for your organization.**
>
> *Refer to [NextJS documentation](https://nextjs.org/docs/app/guides/environment-variables) for additional information on how variables are handled in NextJS specifically.*

---

## Save & Restart

Just to be safe, restart your dev server so it picks up the new environment variables:

1. Terminate the app:
<br>`^` + `C` (Mac)
<br> *or*
<br>`Ctrl` + `C` (PC)

2. Start it again:
```bash
pnpm dev
```

## Enable Management API
This application utilizes the management API to fetch/update profile information as well as manage authenticators for MFA.

Before it can be used, it needs to be enabled.

1. Return to the Auth0 Admin Dashboard
2. Navigate to **Applications** → **the bAInk** → **APIs**.
3. On the **Auth0 Management API** enable **Authorized**.
   ![Enable Management API](./assets/images/the-bAInk-mgmt-enable.png)
4. Click the arrow next to the toggle to expand the menu.
5. Click to select **All**.
6. Click **Update**
   ![Select All Management API Scopes](./assets/images/the-bAInk-mgmt-scopes.png)
7. On the warning that appears, click **Continue**
   ![Select All Management API Scopes](./assets/images/the-bAInk-mgmt-warn.png)

    > [!WARNING]
    > In a production environment, we encourage a least-privilege approach -- *only grant the scopes you know you need*.
    >
    > Even better, do not call the management API directly with a user token -- use a M2M token scoped to the specific service (i.e. your `/user` API).

Great! Now you should be ready to test. 🥳

## Test authentication

1. Open the app at [`http://localhost:3000`](http://localhost:3000).
2. Click **Sign up**.
3. Create a user (use an email you can access).
4. Pick a password. *I know*... passwords are so last year. *That's another lab for another day*.

If everything is working:

* You’ll be redirected back to the app as an authenticated user.
* A message will be sent (automatically) to Aiya that you have *successfully authenticated*.
* From here, accounts + transactions are automatically created for you behind the scenes. 🎉
  * Feel free to click on **Accounts** if you don't believe me!

![First Auth message](./assets/images/the-bAInk-post-auth.gif)

If it doesn’t work:

* Check your `.env` for typos.
* Open the browser console and/or server logs for error details.
* Ask Aiya -- e.g. `I’m failing auth with error XYZ` (*and paste the error message*).