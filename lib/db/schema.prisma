// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
    output   = "./generated/prisma"
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

model Chat {
    id        String    @id @default(ulid())
    userId    String
    title     String?
    messages  Message[]
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    streams   Stream[]

    @@index([userId])
}

model Stream {
    id     String @id @default(ulid())
    chatId String
    chat   Chat   @relation(fields: [chatId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([chatId])
}

model Message {
    id          String    @id @default(ulid())
    chatId      String
    userId      String
    chat        Chat      @relation(fields: [chatId], references: [id], onDelete: Cascade)
    role        String
    parts       Json
    metadata    Json?
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt
    attachments Json?
    vote        VoteType?

    @@index([chatId])
    @@index([userId])
}

enum VoteType {
    up
    down
}

// Financial Account models
model Account {
    id                     String    @id @default(ulid())
    customerId             String // The unique identifier for the customer that owns this account
    isExternal             Boolean?  @default(false)
    externalConnectionId   String?
    externalConnectionName String?
    balance                Float
    currencyCode           String?   @default("USD")
    currencyName           String?   @default("US Dollar")
    currencySymbol         String?   @default("$")
    currencyNumericCode    Float?    @default(840)
    displayName            String?
    name                   String
    number                 String
    openedDate             DateTime
    closedDate             DateTime?
    routingNumber          String
    type                   String
    subType                String? // e.g., "checking", "savings", "credit card", "loan", "investment"
    status                 String?   @default("active") // e.g., "active", "closed", "suspended"

    // Loan-specific fields (nullable for non-loan accounts)
    balanceDue        Float?
    currentPrincipal  Float?
    dueDate           DateTime?
    interestRate      Float?
    lastPaymentDate   DateTime?
    nextPaymentDate   DateTime?
    originalPrincipal Float?
    paymentAmount     Float?
    paymentDate       Int? // Day of month (1-31)
    term              Int? // Months

    // Credit-specific fields (nullable for non-credit accounts)
    cardNumber           String?
    creditLimit          Float?
    minimumPaymentAmount Float?
    statementBalance     Float?

    // Deposit/Investment-specific fields (nullable for other accounts)
    availableBalance Float?
    dividendRate     Float?
    interestYTD      Float?
    cashBalance      Float? // Investment accounts only

    // Relations
    transactions Transaction[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([type])
    @@index([status])
    @@index([number])
    @@index([customerId])
    @@index([externalConnectionId])
}

model Transaction {
    id                     String          @id @default(ulid())
    accountId              String
    customerId             String
    isExternal             Boolean?        @default(false)
    externalConnectionId   String?
    externalConnectionName String?
    payee                  String
    rawPayee               String
    description            String
    memo                   String?
    amount                 Float
    date                   DateTime
    type                   TransactionType
    categoryId             String?
    categoryName           String
    budgetCategoryId       String?
    budgetCategory         String?
    budgetSubcategory      String?
    tags                   Json? // Array of strings
    currencyCode           String?         @default("USD")
    currencyName           String?         @default("United States Dollar")
    currencySymbol         String?         @default("$")
    currencyNumericCode    Float?          @default(840)

    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    account Account? @relation(fields: [accountId], references: [id], onDelete: Cascade)

    @@index([accountId])
    @@index([customerId])
    @@index([date])
    @@index([type])
    @@index([categoryName])
    @@index([budgetCategory])
    @@index([budgetSubcategory])
    @@index([externalConnectionId])
}

enum TransactionType {
    credit
    debit
}

model Document {
    id          String   @id @default(ulid())
    pageContent String
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    embedding   Json
    metadata    Json
}

// SAMPLE DATA

model SampleAccount {
    id                  String    @id @default(ulid())
    customerId          String // The unique identifier for the customer that owns this account
    balance             Float
    currencyCode        String?   @default("USD")
    currencyName        String?   @default("US Dollar")
    currencySymbol      String?   @default("$")
    currencyNumericCode Float?    @default(840)
    displayName         String?
    name                String
    number              String
    openedDate          DateTime
    closedDate          DateTime?
    routingNumber       String
    type                String
    subType             String? // e.g., "checking", "savings", "credit card", "loan", "investment"
    status              String?   @default("active") // e.g., "active", "closed", "suspended"

    // Loan-specific fields (nullable for non-loan accounts)
    balanceDue        Float?
    currentPrincipal  Float?
    dueDate           DateTime?
    interestRate      Float?
    lastPaymentDate   DateTime?
    nextPaymentDate   DateTime?
    originalPrincipal Float?
    paymentAmount     Float?
    paymentDate       Int? // Day of month (1-31)
    term              Int? // Months

    // Credit-specific fields (nullable for non-credit accounts)
    cardNumber           String?
    creditLimit          Float?
    minimumPaymentAmount Float?
    statementBalance     Float?

    // Deposit/Investment-specific fields (nullable for other accounts)
    availableBalance Float?
    dividendRate     Float?
    interestYTD      Float?
    cashBalance      Float? // Investment accounts only

    // Relations
    transactions SampleTransaction[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([customerId])
}

model SampleTransaction {
    id                  String          @id @default(ulid())
    accountId           String
    customerId          String
    payee               String
    rawPayee            String
    description         String
    memo                String?
    amount              Float
    date                DateTime
    type                TransactionType
    categoryId          String?
    categoryName        String
    budgetCategoryId    String?
    budgetCategory      String?
    budgetSubcategory   String?
    tags                Json? // Array of strings
    currencyCode        String?         @default("USD")
    currencyName        String?         @default("United States Dollar")
    currencySymbol      String?         @default("$")
    currencyNumericCode Float?          @default(840)

    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    account SampleAccount? @relation(fields: [accountId], references: [id], onDelete: Cascade)

    @@index([accountId])
    @@index([customerId])
}

model SampleDocument {
    id          String   @id @default(ulid())
    pageContent String
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    embedding   Json
    metadata    Json
}
